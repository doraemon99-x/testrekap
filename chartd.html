<!DOCTYPE html>
<html>
<head>
    <title>Real Count PilPres 2024</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #1a1919;
            margin: 20px;
            text-align: center;
            
        }

        h1 {
            color: #563ceb;
            text-align: center;
        }
        
    </style>
    <h1>Real Count PilPres 2024 Tingkat Nasionall</h1>
    <canvas id="myChart" width="300" height="300"></canvas>
    <script>
        // Fungsi untuk mengambil data dari URL dan membuat diagram pie
        async function fetchDataAndCreateChart() {
            const url = 'https://sirekap-obj-data.kpu.go.id/pemilu/hhcw/ppwp.json';
            const response = await fetch(url);
            const data = await response.json();
            
            const chartData = data['chart'];
            delete chartData['persen'];  // Hapus 'persen' dari data
            const labels = Object.keys(chartData).map(key => {
                if (key === '100025') return 'Anis';
                if (key === '100026') return 'Prabowo';
                if (key === '100027') return 'Ganjar';
                return key;
            });
            const values = Object.values(chartData);

            const ctx = document.getElementById('myChart').getContext('2d');
            new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Votes',
                        data: values,
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.2)',
                            'rgba(54, 162, 235, 0.2)',
                            'rgba(255, 206, 86, 0.2)'
                        ],
                        borderColor: [
                            'rgba(255, 99, 132, 1)',
                            'rgba(54, 162, 235, 1)',
                            'rgba(255, 206, 86, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    tooltips: {
                        callbacks: {
                            label: function(tooltipItem, data) {
                                var label = data.labels[tooltipItem.index];
                                var value = data.datasets[tooltipItem.datasetIndex].data[tooltipItem.index];
                                return label + ': ' + value;
                            }
                        }
                    },
                    plugins: {
                        datalabels: {
                            formatter: (value, ctx) => {
                                let sum = 0;
                                let dataArr = ctx.chart.data.datasets[0].data;
                                dataArr.map(data => {
                                    sum += data;
                                });
                                let percentage = (value*100 / sum).toFixed(2)+"%";
                                return percentage;
                            },
                            color: '#fff',
                        }
                    }
                }
            });
        }

        // Panggil fungsi ketika halaman dimuat
        window.onload = fetchDataAndCreateChart;
    </script>
</body>
</html>
